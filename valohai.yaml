- step:
    name: yolo-training
    image: docker.io/ultralytics/ultralytics:8.0.180-python
    command:
      - python train-model.py --epochs {parameters.epochs} --optimizer {parameters.optimizer}
    input:
      - name: dataset
        default: /valohai/inputs/dataset/coco128.zip  # path to your dataset
    parameters:
      - name: epochs
        type: integer
        default: 2
      - name: optimizer
        type: string
        default: SGD
    environment: aws-eu-west-1-g4dn-xlarge

- step:
    name: yolo-inference
    image: docker.io/ultralytics/ultralytics:8.0.180-python
    command:
      - python predict.py
    inputs:
      - name: model
        default: /valohai/inputs/model/best.onnx # path to your model
      - name: images
        default: /valohai/inputs/images/ # path to inference images
    environment: aws-eu-west-1-g4dn-xlarge

- pipeline:
    name: yolo-training-inference-pipeline
    nodes:
      - name: training
        step: yolo-training
      - name: inference
        step: yolo-inference
        depends_on: [training]
    edges: [] # In this case, manual adjustment or an automated script is needed to connect output from training to inference step input.

