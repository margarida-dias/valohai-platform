- step:
    name: install-dependencies
    image: docker.io/python:3.9.5
    command:
        - pip install -r requirements.txt
    inputs:
      - name: requirements
        default: requirements.txt

- step:
    name: yolo-training
    image: docker.io/ultralytics/ultralytics:8.0.180-python
    command:
      - python train-model.py --epochs {parameters.epochs} --optimizer {parameters.optimizer}
    inputs:
      - name: dataset
        default: /valohai/inputs/dataset/coco128.zip
    parameters:
      - name: epochs
        type: integer
        default: 2
      - name: optimizer
        type: string
        default: SGD

- step:
    name: yolo-inference
    image: docker.io/ultralytics/ultralytics:8.0.180-python
    command:
      - python predict.py
    inputs:
      - name: model
        default: /valohai/inputs/model/best.onnx
      - name: images
        default: /valohai/inputs/images/

- pipeline:
    name: yolo-training-inference-pipeline
    nodes:
      - name: setup project
        type: execution
        step: install-dependencies
      - name: training
        type: execution
        step: yolo-training
      - name: inference
        type: execution
        step: yolo-inference
    edges:
      - [ training.output.model, inference.input.model ]


