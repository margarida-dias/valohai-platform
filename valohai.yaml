- step:
    name: yolo-training
    image: docker.io/ultralytics/ultralytics:8.0.180-python
    command:
      - python train-model.py --epochs {parameters.epochs} --optimizer {parameters.optimizer}
    inputs:
      - name: dataset
        default: /valohai/inputs/dataset/coco128.zip
    parameters:
      - name: epochs
        type: integer
        default: 2
      - name: optimizer
        type: string
        default: SGD
    environment: aws-eu-west-1-g4dn-xlarge

- step:
    name: yolo-inference
    image: docker.io/ultralytics/ultralytics:8.0.180-python
    command:
      - python predict.py
    inputs:
      - name: model
        default: /valohai/inputs/model/best.onnx
      - name: images
        default: /valohai/inputs/images/
    environment: aws-eu-west-1-g4dn-xlarge

- pipeline:
    name: yolo-training-inference-pipeline
    nodes:
      - name: training
        type: execution
        step: yolo-training
      - name: inference
        type: execution
        step: yolo-inference
        dependencies: [training]


